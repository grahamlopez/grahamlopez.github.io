
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>git credentials &#8212; graham lopez  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="git Workflows – how to organize branching" href="git_workflows.html" />
    <link rel="prev" title="Shortcuts and configuration" href="shortcuts_and_conf.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">graham lopez</a></h1>



<p class="blurb">Notes by/for, and a little bit about M. Graham Lopez</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact me</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cv.html">Curriculum Vitae</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">git hints</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="git_philosophy.html">git philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="best_practices.html">General best practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="confusion.html">git Annoyances – common points of confusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="shortcuts_and_conf.html">Shortcuts and configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">git credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="git_workflows.html">git Workflows – how to organize branching</a></li>
<li class="toctree-l2"><a class="reference internal" href="repo_histories.html">Repository histories</a></li>
<li class="toctree-l2"><a class="reference internal" href="resources.html">Big list o’ resources – links to external sites</a></li>
<li class="toctree-l2"><a class="reference internal" href="unsorted.html">Unsorted git</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../privacy_security/index.html">Privacy / Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contained/index.html">Containers / VPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli_tools/index.html">CLI Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blog/index.html">blog(ish)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/index.html">unsorted</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/index.html">sphinx</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">git hints</a><ul>
      <li>Previous: <a href="shortcuts_and_conf.html" title="previous chapter">Shortcuts and configuration</a></li>
      <li>Next: <a href="git_workflows.html" title="next chapter">git Workflows – how to organize branching</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="shortcuts_and_conf.html" title="Previous document">Shortcuts and configuration</a>
        </li>
        <li>
          <a href="git_workflows.html" title="Next document">git Workflows – how to organize branching</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <div class="section" id="git-credentials">
<h1>git credentials<a class="headerlink" href="#git-credentials" title="Permalink to this headline">¶</a></h1>
<div class="section" id="username">
<h2>username<a class="headerlink" href="#username" title="Permalink to this headline">¶</a></h2>
<p>Nothing special needs to be done for git to remember the username for repository
access, just include it in the clone URL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">username</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">reponame</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Or add it afterwards using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">remote</span> <span class="pre">set-url</span> <span class="pre">&lt;name&gt;</span> <span class="pre">&lt;newurl&gt;</span></code>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="nb">set</span><span class="o">-</span><span class="n">url</span> <span class="n">origin</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">username</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">reponame</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</div>
<div class="section" id="on-disk-file-storage-encrypted">
<h2>On-disk file storage (encrypted)<a class="headerlink" href="#on-disk-file-storage-encrypted" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Download the <a class="reference external" href="https://raw.githubusercontent.com/git/git/master/contrib/credential/netrc/git-credential-netrc" target="_blank">git-credential-netrc</a>
helper script and put it somewhere in your <code class="docutils literal notranslate"><span class="pre">$PATH</span></code>.</p>
</li>
<li><p class="first">make a <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code> with the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">machine</span> <span class="n">a_server</span><span class="o">.</span><span class="n">corp</span><span class="o">.</span><span class="n">com</span>
<span class="n">login</span> <span class="n">a_login</span>
<span class="n">password</span> <span class="n">a_password</span>
<span class="n">protocol</span> <span class="n">https</span>

<span class="n">machine</span> <span class="n">a_server2</span><span class="o">.</span><span class="n">corp</span><span class="o">.</span><span class="n">com</span>
<span class="n">login</span> <span class="n">a_login2</span>
<span class="n">password</span> <span class="n">a_password2</span>
<span class="n">protocol</span> <span class="n">https</span>
</pre></div>
</div>
</li>
<li><p class="first">create or import a gpg key that has a passphrase</p>
</li>
<li><p class="first">encrypt the file with <code class="docutils literal notranslate"><span class="pre">gpg</span> <span class="pre">-e</span> <span class="pre">-r</span> <span class="pre">a_recipient</span> <span class="pre">.netrc</span></code> and then delete the
plaintext <code class="docutils literal notranslate"><span class="pre">~/.netrc</span></code> * tell git to use the encrypted file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="n">local</span> <span class="n">credential</span><span class="o">.</span><span class="n">helper</span> <span class="s2">&quot;netrc -f ~/.netrc.gpg -v&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>Now the credential helper will decrypt the <code class="docutils literal notranslate"><span class="pre">~/.netrc.gpg</span></code> file asking for the
gpg key’s passphrase, and the gpg-agent should store the passphrase from then
onwards (e.g. until reboot).</p>
<div class="section" id="decrypt-from-the-terminal">
<h3>decrypt from the terminal<a class="headerlink" href="#decrypt-from-the-terminal" title="Permalink to this headline">¶</a></h3>
<p>With modern versions of GPG (since 2.1), it will try to show a pinentry prompt
by default. This might result in the following error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Using</span> <span class="n">GPG</span> <span class="n">to</span> <span class="nb">open</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">graham</span><span class="o">/.</span><span class="n">netrc</span><span class="o">.</span><span class="n">gpg</span><span class="p">:</span> <span class="p">[</span><span class="n">gpg</span> <span class="o">--</span><span class="n">decrypt</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">graham</span><span class="o">/.</span><span class="n">netrc</span><span class="o">.</span><span class="n">gpg</span><span class="p">]</span>
<span class="n">gpg</span><span class="p">:</span> <span class="n">encrypted</span> <span class="k">with</span> <span class="mi">2048</span><span class="o">-</span><span class="n">bit</span> <span class="n">RSA</span> <span class="n">key</span><span class="p">,</span> <span class="n">ID</span> <span class="mi">786569</span><span class="n">FF6ED67CBA</span><span class="p">,</span> <span class="n">created</span> <span class="mi">2018</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">05</span>
      <span class="s2">&quot;graham lopez &lt;myaddr@email.com&gt;&quot;</span>
<span class="n">gpg</span><span class="p">:</span> <span class="n">public</span> <span class="n">key</span> <span class="n">decryption</span> <span class="n">failed</span><span class="p">:</span> <span class="n">Inappropriate</span> <span class="n">ioctl</span> <span class="k">for</span> <span class="n">device</span>
<span class="n">gpg</span><span class="p">:</span> <span class="n">decryption</span> <span class="n">failed</span><span class="p">:</span> <span class="n">No</span> <span class="n">secret</span> <span class="n">key</span>
<span class="n">No</span> <span class="n">netrc</span> <span class="n">entries</span> <span class="n">found</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">graham</span><span class="o">/.</span><span class="n">netrc</span><span class="o">.</span><span class="n">gpg</span>
</pre></div>
</div>
<p>This occurs because the credential helper isn’t running through a TTY, so
there’s no way to render the prompt. Fix this by telling gpg to use loopback
pinentry mode. (<a class="reference external" href="https://d.sb/2016/11/gpg-inappropriate-ioctl-for-device-errors)" target="_blank">Solution described here</a> - add to
<code class="docutils literal notranslate"><span class="pre">~/.gnupg/gpg.conf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">use</span><span class="o">-</span><span class="n">agent</span>
<span class="n">pinentry</span><span class="o">-</span><span class="n">mode</span> <span class="n">loopback</span>
</pre></div>
</div>
<p>(NOTE: adding this to <code class="docutils literal notranslate"><span class="pre">~/.gnupg/gpg.conf</span></code> could break other usage, so might
want to edit the <code class="docutils literal notranslate"><span class="pre">git-credential-netrc</span></code> script to use <code class="docutils literal notranslate"><span class="pre">gpg</span> <span class="pre">--decrypt</span>
<span class="pre">--pinentry-mode</span> <span class="pre">loopback</span></code> instead.) - add to <code class="docutils literal notranslate"><span class="pre">~/.gnupg/gpg-agent.conf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">allow</span><span class="o">-</span><span class="n">loopback</span><span class="o">-</span><span class="n">pinentry</span>
</pre></div>
</div>
<p>and then restart the gpg-agent with <code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">RELOADAGENT</span> <span class="pre">|</span> <span class="pre">gpg-connect-agent</span></code></p>
</div>
</div>
<div class="section" id="in-memory-password-caching">
<h2>In-memory password caching<a class="headerlink" href="#in-memory-password-caching" title="Permalink to this headline">¶</a></h2>
<p>On almost all systems, git can cache the password in memory for some amount of
time. This is stored either globally in <code class="docutils literal notranslate"><span class="pre">$HOME/.gitconfig</span></code> or per-repo in
<code class="docutils literal notranslate"><span class="pre">/path/to/repo-root/.gitconfig</span></code>. The following would cache the password for 10
minutes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">credential</span><span class="p">]</span>
    <span class="n">helper</span> <span class="o">=</span> <span class="n">cache</span> <span class="o">--</span><span class="n">timeout</span><span class="o">=</span><span class="mi">600</span>
</pre></div>
</div>
<p>This can be set via the command-line with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">[--global]</span>
<span class="pre">credential.helper</span> <span class="pre">'cache</span> <span class="pre">--timeout=600'</span></code></p>
</div>
<div class="section" id="keychain-based-password-caching">
<h2>Keychain-based password caching<a class="headerlink" href="#keychain-based-password-caching" title="Permalink to this headline">¶</a></h2>
<div class="section" id="ubuntu-17-10">
<h3>Ubuntu 17.10<a class="headerlink" href="#ubuntu-17-10" title="Permalink to this headline">¶</a></h3>
<p>Ubuntu with Gnome will have gnome-keyring already installed. Seahorse is also
available via apt. So we just need to set up the credential helper for git to
talk to gnome-keyring:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span> <span class="n">install</span> <span class="n">libgnome</span><span class="o">-</span><span class="n">keyring</span><span class="o">-</span><span class="n">dev</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">contrib</span><span class="o">/</span><span class="n">credential</span><span class="o">/</span><span class="n">gnome</span><span class="o">-</span><span class="n">keyring</span>
<span class="n">make</span>
<span class="n">chmod</span> <span class="mi">755</span> <span class="n">git</span><span class="o">-</span><span class="n">credential</span><span class="o">-</span><span class="n">gnome</span><span class="o">-</span><span class="n">keyring</span>
<span class="n">git</span> <span class="n">config</span> <span class="o">--</span><span class="k">global</span> <span class="n">credential</span><span class="o">.</span><span class="n">helper</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">contrib</span><span class="o">/</span><span class="n">credential</span><span class="o">/</span><span class="n">gnome</span><span class="o">-</span><span class="n">keyring</span><span class="o">/</span><span class="n">git</span><span class="o">-</span><span class="n">credential</span><span class="o">-</span><span class="n">gnome</span><span class="o">-</span><span class="n">keyring</span>
</pre></div>
</div>
</div>
<div class="section" id="gentoo-outside-of-gnome">
<h3>Gentoo (outside of Gnome)<a class="headerlink" href="#gentoo-outside-of-gnome" title="Permalink to this headline">¶</a></h3>
<p>We can use gnome-keyring as a git credential helper outside of Gnome as well.
We’ll need X support compiled into dbus</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">USE=X</span> <span class="pre">emerge</span> <span class="pre">-av</span> <span class="pre">-oneshot</span> <span class="pre">dbus</span></code></div></blockquote>
<p>now get the working pieces</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">emerge</span> <span class="pre">-av</span> <span class="pre">gnome-keyring</span> <span class="pre">libsecret</span> <span class="pre">seahorse</span></code></div></blockquote>
<p>and finally set up git to use the credential helper</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">USE=gnome-keyring</span> <span class="pre">emerge</span> <span class="pre">-av</span> <span class="pre">dev-vcs/git</span></code>
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">credential.helper</span> <span class="pre">/usr/bin/git-credential-libsecret</span></code></div></blockquote>
<p>make sure the keyring daemon starts with X, so add to <code class="docutils literal notranslate"><span class="pre">~/.xinitrc</span></code></p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">eval</span> <span class="pre">$(/usr/bin/gnome-keyring-daemon</span> <span class="pre">--start</span> <span class="pre">--components=pkcs11,secrets,ssh)</span></code></div></blockquote>
</div>
<div class="section" id="interacting-with-the-keyring">
<h3>Interacting with the keyring<a class="headerlink" href="#interacting-with-the-keyring" title="Permalink to this headline">¶</a></h3>
<p>To see what is in the keychain, use <code class="docutils literal notranslate"><span class="pre">seahorse</span></code>. Any of the keychains can also
be unlocked here.</p>
<p>To unlock from the commandline, use <code class="docutils literal notranslate"><span class="pre">secret-tool</span></code>. It needs a an
attribute/value pair to search on, so to see what these are, open up seahorse
and look at the “details” tab of a given entry. For git, the entries typically
have the following attributes: “server”, “user”, “protocol”. Server is e.g.
“github.com” and protocol is typically “https”. So use <code class="docutils literal notranslate"><span class="pre">secret-tool</span></code> to unlock
the keychain (and see the values) like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">secret</span><span class="o">-</span><span class="n">tool</span> <span class="n">search</span> <span class="o">--</span><span class="nb">all</span> <span class="o">--</span><span class="n">unlock</span> <span class="n">protocol</span> <span class="n">https</span>
</pre></div>
</div>
<p>secret-tool can be used from the cli to store/retrieve arbitrary strings using
arbitrary attribute/value pairs, but I haven’t found a way to add attributes to
what the <code class="docutils literal notranslate"><span class="pre">git-credential-libsecret</span></code> utility automatically adds to the keyring.</p>
<p>I haven’t yet found a way to automatically prompt for unlock at login such as
happens with display managers like gdm, lightdm, etc.</p>
</div>
<div class="section" id="osx-keychain">
<h3>OSX keychain<a class="headerlink" href="#osx-keychain" title="Permalink to this headline">¶</a></h3>
<p>See if the OSX keychain credential helper is already installed
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">credential-osxkeychain</span></code></p>
<p>If it isn’t, OSX may prompt you to install it as part of the Xcode commandline
tools. Otherwise, it gets installed as part of the homebrew ‘git’ package.</p>
<p>Set git to use the OSX keychain
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">config</span> <span class="pre">--global</span> <span class="pre">credential.helper</span> <span class="pre">osxkeychain</span></code></p>
<p>use the <code class="docutils literal notranslate"><span class="pre">/Applications/Utilities/Keychain</span> <span class="pre">Access.app</span></code> to verify your password
storage.</p>
</div>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://git-scm.com/docs/git-credential-cache" target="_blank">git-credential-cache</a></li>
<li><a class="reference external" href="https://git-scm.com/docs/gitcredentials" target="_blank">gitcredentials(7)</a></li>
<li><a class="reference external" href="https://wiki.archlinux.org/index.php/GNOME/Keyring" target="_blank">gnome-keyring outside of Gnome</a></li>
<li><a class="reference external" href="https://help.github.com/articles/caching-your-github-password-in-git/#platform-mac" target="_blank">github docs</a></li>
<li><a class="reference external" href="https://github.com/git/git/blob/master/contrib/credential/netrc/git-credential-netrc" target="_blank">git-gredential-netrc</a></li>
<li><a class="reference external" href="https://stackoverflow.com/questions/5343068/is-there-a-way-to-skip-password-typing-when-using-https-on-github/18362082" target="_blank">gpg encrypted file-based storage</a></li>
</ul>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="shortcuts_and_conf.html" title="Previous document">Shortcuts and configuration</a>
        </li>
        <li>
          <a href="git_workflows.html" title="Next document">git Workflows – how to organize branching</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019, M. Graham Lopez.
      
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-140879797-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>